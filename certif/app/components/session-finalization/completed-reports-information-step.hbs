<div class="table session-finalization-reports">

  {{#if (gt @session.uncompletedCertificationReports.length 0)}}
    <PixNotificationAlert class="session-finalization-reports__information" @withIcon={{true}} @type="success">
      {{t "pages.session-finalization.reporting.completed-reports-information.description"}}
    </PixNotificationAlert>
  {{/if}}

  <PixTable
    @data={{@certificationReports}}
    @variant="certif"
    @caption={{t "pages.session-finalization.reporting.completed-reports-information.extra-information"}}
  >
    <:columns as |report context|>
      <PixTableColumn @context={{context}}>
        <:header>
          {{t "common.labels.candidate.lastname"}}
        </:header>
        <:cell>
          {{report.lastName}}
        </:cell>
      </PixTableColumn>
      <PixTableColumn @context={{context}}>
        <:header>
          {{t "common.labels.candidate.firstname"}}
        </:header>
        <:cell>
          {{report.firstName}}
        </:cell>
      </PixTableColumn>
      <PixTableColumn @context={{context}}>
        <:header>
          {{t "pages.session-finalization.reporting.table.labels.certification-number"}}
        </:header>
        <:cell>
          {{report.certificationCourseId}}
        </:cell>
      </PixTableColumn>
      <PixTableColumn @context={{context}}>
        <:header>
          {{t "pages.session-finalization.reporting.table.labels.reporting"}}
        </:header>
        <:cell>
          <div class="finalization-report-examiner-comment">
            {{#if report.certificationIssueReports}}
              <button
                type="button"
                class="button--showed-as-link add-button"
                {{on "click" (fn this.openIssueReportsModal report)}}
              >
                <PixIcon @name="add" @plainIcon={{true}} @ariaHidden={{true}} />
                {{t "common.actions.add"}}
                /
                {{t "common.actions.delete"}}
              </button>
              <p data-test-id="finalization-report-has-examiner-comment_{{report.certificationCourseId}}">
                {{t
                  "pages.session-finalization.reporting.table.reporting-count"
                  reportingsCount=report.certificationIssueReports.length
                }}
              </p>
            {{else}}
              <button
                type="button"
                class="button--showed-as-link add-button"
                {{on "click" (fn this.openAddIssueReportModal report)}}
              >
                <PixIcon @name="add" @plainIcon={{true}} @ariaHidden={{true}} />
                {{t "common.actions.add"}}
              </button>
            {{/if}}
          </div>
        </:cell>
      </PixTableColumn>
      {{#if @shouldDisplayHasSeenEndTestScreenCheckbox}}
        <PixTableColumn @context={{context}}>
          <:header>
            <PixCheckbox
              data-test-id="finalization-report-all-candidates-have-seen-end-test-screen"
              @isIndeterminate={{this.hasPartialState}}
              @checked={{this.hasCheckState}}
              @class="session-finalization-reports__checker"
              {{on "click" (fn @onAllHasSeenEndTestScreenCheckboxesClicked this.hasCheckedEverything)}}
            >
              <:label>{{t "pages.session-finalization.reporting.table.labels.end-of-test-screen"}}</:label>
            </PixCheckbox>
          </:header>
          <:cell>
            <PixCheckbox
              @screenReaderOnly={{true}}
              data-test-id="finalization-report-has-seen-end-test-screen_{{report.certificationCourseId}}"
              @checked={{report.hasSeenEndTestScreen}}
              {{on "click" (fn @onHasSeenEndTestScreenCheckboxClicked report)}}
            >
              <:label>{{t
                  "pages.session-finalization.reporting.table.labels.end-of-test-screen-for-candidate"
                  firstName=report.firstName
                  lastName=report.lastName
                }}</:label>
            </PixCheckbox>
          </:cell>
        </PixTableColumn>
      {{/if}}
    </:columns>
  </PixTable>

  {{#if this.showAddIssueReportModal}}
    <IssueReportModal::AddIssueReportModal
      @showModal={{this.showAddIssueReportModal}}
      @closeModal={{this.closeAddIssueReportModal}}
      @report={{this.reportToEdit}}
      @maxlength={{@issueReportDescriptionMaxLength}}
      @version={{@session.version}}
    />
  {{/if}}

  {{#if this.showIssueReportsModal}}
    <IssueReportModal::IssueReportsModal
      @showModal={{this.showIssueReportsModal}}
      @closeModal={{this.closeIssueReportsModal}}
      @onClickIssueReport={{this.openAddIssueReportModal}}
      @onClickDeleteIssueReport={{@onIssueReportDeleteButtonClicked}}
      @report={{this.reportToEdit}}
      @version={{@session.version}}
    />
  {{/if}}
</div>